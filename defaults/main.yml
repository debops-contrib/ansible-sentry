---
sentry__base_packages:
  - python-setuptools
  - python-pip
  - python-virtualenv
  - virtualenv  # Only on debian?
  - python-dev
  - libxslt1-dev
  - gcc
  - libffi-dev
  - libjpeg-dev
  - libxml2-dev
  - libxslt-dev
  - libyaml-dev
  - postgresql-server-dev-9.4
  - cmake

sentry__packages: []

sentry__version: '8.10.0'

sentry__fqdn: 'sentry.{{ sentry__domain }}'

sentry__domain: '{{ ansible_domain if ansible_domain else ansible_hostname }}'

sentry__pip_base_packages:
  - name: 'sentry'
    version: '{{ sentry__version }}'

sentry__pip_packages: []

sentry__user: 'sentry'
sentry__group: 'sentry'

sentry__database_user: 'sentry'
sentry__database_name: 'sentry'

sentry__postgresql_user_role:
  name: '{{ sentry__database_user }}'
  flags:
    - 'NOSUPERUSER'
    - 'NOCREATEROLE'
    - 'NOCREATEDB'
    - 'NOINHERIT'
    - 'NOREPLICATION'
    - 'LOGIN'
  db: '{{ sentry__database_name }}'

sentry__postgresql_roles:
  - '{{ sentry__postgresql_user_role }}'  # Password is not passed directly - it will be read from the file

sentry__postgresql_database:
  name: '{{ sentry__database_name }}'
  owner: '{{ sentry__database_user }}'

sentry__superusers: '{{ lookup("template", "lookup/sentry__config_admins.j2") | from_yaml }}'
sentry__superuser_password_length: '32'

sentry__apt__sources:
  - uri:        'http://httpredir.debian.org/debian'
    comment:    'Debian Stretch repository'
    type:       'deb'
    suite:      'stretch'
    components: 'main'
    distribution: 'Debian'

sentry__apt_preferences__list:
  - package: 'cmake'
    by_role: 'debops.sentry'
    suffix: '_Debian'
    raw: |
      Explanation: Install cmake from testing. Sentry 8.10.x needs symsynd which needs CMake 3.4.3+
      Package: cmake
      Pin: release o=Debian,n=stretch
      Pin-Priority: 500

sentry__nginx_upstream:
  name: 'sentry'
  enabled: True
  type: 'default'
  server: ['[::1]:9000']

sentry__nginx_web_server:
  enabled: True
  name: '{{ sentry__domain }}'
  welcome: False
  ssl: True
  acme: False
  root: False
  index: False
  favicon: True
  redirect_to_ssl: True
  location:
    '/': |
      include     uwsgi_params;
      uwsgi_pass  sentry;
